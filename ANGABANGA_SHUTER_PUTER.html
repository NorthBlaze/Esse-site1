<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Арканоид с бонусами и магазином</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            height: 100%;
            background: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        canvas {
            display: block;
            background-color: #000;
            border: 1px solid #fff;
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            background-image: url('https://i.pinimg.com/originals/36/ee/1e/36ee1e1df0e7b8f5df82fa555eda353e.png');
            background-size: cover;
            background-position: center;
        }
        .game-info {
            position: absolute;
            color: white;
            font-size: 20px;
            z-index: 10;
        }
        .score {
            top: 10px;
            left: 10px;
        }
        .coins {
            top: 10px;
            right: 10px;
            font-size: 20px;
        }
        .game-over {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            text-align: center;
        }
        .restart-button {
            background-color: #f1c40f;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        .restart-button:hover {
            background-color: #e67e22;
        }
        .main-menu, .difficulty-menu {
            position: absolute;
            color: white;
            font-size: 30px;
            top: 30%;
            text-align: center;
            z-index: 10;
        }
        .difficulty-menu {
            top: 50%;
        }
        .menu-button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .menu-button:hover {
            background-color: #2980b9;
        }
        .shop {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .shop-item {
            background-color: #f1c40f;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .shop-item:hover {
            background-color: #e67e22;
        }
        .hidden {
            display: none;
        }
        .shop-message {
            color: red;
            font-size: 18px;
            margin-top: 10px;
        }
        .back-button {
            background-color: #e74c3c;
            color: #fff;
            padding: 10px 20px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .back-button:hover {
            background-color: #c0392b;
        }
        .back-to-main-menu {
            background-color: #f39c12;
            color: white;
            font-size: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 20px;
            cursor: pointer;
        }
        .back-to-main-menu:hover {
            background-color: #e67e22;
        }
        .login {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 20px;
            text-align: center;
        }
        .login input {
            margin: 10px;
            padding: 10px;
            font-size: 18px;
            border-radius: 5px;
        }
        .login button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .login button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<!-- Счетчик монет -->
<div class="game-info score">
    Очки: <span id="score">0</span>
</div>
<div class="game-info coins">
    Монеты: <span id="coins">0</span>
</div>

<!-- Сообщение о завершении игры -->
<div class="game-info game-over hidden" id="gameOverMessage">
    Игра окончена
    <br><button class="restart-button" id="restartBtn">Начать заново</button>
</div>

<!-- Главное меню -->
<div class="main-menu hidden" id="mainMenu">
    <h2>Добро пожаловать в Арканоид</h2>
    <button class="menu-button" id="startBtn">Начать игру</button>
    <button class="menu-button" id="shopBtn">Магазин</button>
</div>

<!-- Меню выбора сложности -->
<div class="difficulty-menu hidden" id="difficultyMenu">
    <h2>Выберите уровень сложности</h2>
    <button class="menu-button" id="easyBtn">Легкий</button>
    <button class="menu-button" id="mediumBtn">Средний</button>
    <button class="menu-button" id="hardBtn">Сложный</button>
    <button class="back-to-main-menu" id="backToMainMenuBtn">Вернуться на главную</button>
</div>

<!-- Магазин -->
<div class="shop hidden" id="shop">
    <h3>Магазин</h3>
    <button class="shop-item" id="buyExtraPaddle">Купить дополнительную платформу (1299 монет)</button>
    <button class="shop-item" id="buyPaddleColor">Изменить цвет платформы (100 монет)</button>
    <p id="coins">Монеты: 0</p>
    <div id="shopMessage" class="shop-message hidden"></div>
    <button class="back-button" id="backToMenuBtn">Вернуться в меню</button>
</div>

<!-- Экран входа -->
<div class="login" id="loginScreen">
    <h2>Введите ваше имя</h2>
    <input type="text" id="username" placeholder="Ваше имя">
    <button id="loginBtn">Войти</button>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let canvasWidth, canvasHeight;
    let paddleX, paddleWidth = 100, paddleHeight = 20, paddleSpeed = 6;
    let ballX, ballY, ballSpeedX, ballSpeedY, ballRadius = 10;
    let bricks = [];
    let score = 0, coins = 0;
    let gameOver = false;
    let ballSpeedMultiplier = 1;
    let difficulty = "medium"; // Средняя сложность по умолчанию
    let username = ""; // Имя пользователя

    // Установка размеров канваса
    function setCanvasSize() {
        canvasWidth = window.innerWidth;
        canvasHeight = window.innerHeight;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
    }

    // Начало игры
    function startGame() {
        document.getElementById("loginScreen").classList.add("hidden");
        document.getElementById("mainMenu").classList.add("hidden");
        document.getElementById("difficultyMenu").classList.add("hidden");
        document.getElementById("shop").classList.add("hidden");

        // Начальная позиция мяча
        ballX = canvasWidth / 2;
        ballY = canvasHeight - paddleHeight - ballRadius - 10;
        ballSpeedX = 4;
        ballSpeedY = -4;
        paddleX = (canvasWidth - paddleWidth) / 2;

        createBricks();
        gameLoop();
    }

    // Создание блоков
    function createBricks() {
        bricks = [];
        for (let row = 0; row < 5; row++) {
            bricks[row] = [];
            for (let col = 0; col < 7; col++) {
                bricks[row][col] = { x: col * (brickWidth + brickPadding) + brickOffsetLeft, y: row * (brickHeight + brickPadding) + brickOffsetTop, status: 1 };
            }
        }
    }

    // Главный игровой цикл
    function gameLoop() {
        if (gameOver) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ballX += ballSpeedX * ballSpeedMultiplier;
        ballY += ballSpeedY * ballSpeedMultiplier;

        // Столкновение с границами экрана
        if (ballX + ballRadius > canvasWidth || ballX - ballRadius < 0) {
            ballSpeedX = -ballSpeedX;
        }

        if (ballY - ballRadius < 0) {
            ballSpeedY = -ballSpeedY;
        } else if (ballY + ballRadius > canvasHeight) {
            if (ballX > paddleX && ballX < paddleX + paddleWidth) {
                ballSpeedY = -ballSpeedY;
                const hitPosition = (ballX - paddleX) / paddleWidth;
                ballSpeedX = (hitPosition - 0.5) * 10;
                score++;
                coins++;
                updateUI();
            } else {
                gameOver = true;
                document.getElementById("gameOverMessage").classList.remove("hidden");
                return;
            }
        }

        // Управление платформой
        document.addEventListener("mousemove", (e) => {
            paddleX = e.clientX - paddleWidth / 2;
            if (paddleX < 0) paddleX = 0;
            if (paddleX > canvasWidth - paddleWidth) paddleX = canvasWidth - paddleWidth;
        });

        ctx.beginPath();
        ctx.rect(paddleX, canvasHeight - paddleHeight, paddleWidth, paddleHeight);
        ctx.fillStyle = "#0095DD";
        ctx.fill();
        ctx.closePath();

        ctx.beginPath();
        ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
        ctx.fillStyle = "#0095DD";
        ctx.fill();
        ctx.closePath();

        requestAnimationFrame(gameLoop);
    }

    // Обновление UI (очки и монеты)
    function updateUI() {
        document.getElementById("score").textContent = score;
        document.getElementById("coins").textContent = coins;
    }

    // Вход по имени
    document.getElementById("loginBtn").addEventListener("click", () => {
        const inputUsername = document.getElementById("username").value.trim();
        if (inputUsername) {
            username = inputUsername;
            localStorage.setItem('username', username);
            document.getElementById("loginScreen").classList.add("hidden");
            startGame();
        } else {
            alert("Введите имя для входа.");
        }
    });

    // Кнопка "Начать игру"
    document.getElementById("startBtn").addEventListener("click", () => {
        document.getElementById("mainMenu").classList.add("hidden");
        document.getElementById("difficultyMenu").classList.remove("hidden");
    });

    // Кнопки выбора сложности
    document.getElementById("easyBtn").addEventListener("click", () => {
        difficulty = "easy";
        startGame();
    });

    document.getElementById("mediumBtn").addEventListener("click", () => {
        difficulty = "medium";
        startGame();
    });

    document.getElementById("hardBtn").addEventListener("click", () => {
        difficulty = "hard";
        startGame();
    });

    // Кнопка назад в меню
    document.getElementById("backToMainMenuBtn").addEventListener("click", () => {
        document.getElementById("difficultyMenu").classList.add("hidden");
        document.getElementById("mainMenu").classList.remove("hidden");
    });

    setCanvasSize();
    window.addEventListener('resize', setCanvasSize);
</script>

</body>
</html>

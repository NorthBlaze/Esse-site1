<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Арканоид с бонусами и магазином</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            height: 100%;
            background: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        canvas {
            display: block;
            background-color: #000;
            border: 1px solid #fff;
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            background-image: url('https://i.pinimg.com/originals/36/ee/1e/36ee1e1df0e7b8f5df82fa555eda353e.png'); /* Ваш фон */
            background-size: cover;
            background-position: center;
        }
        .game-info {
            position: absolute;
            color: white;
            font-size: 20px;
            z-index: 10;
        }
        .score {
            top: 10px;
            left: 10px;
        }
        .game-over {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            text-align: center;
        }
        .restart-button {
            background-color: #f1c40f;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        .restart-button:hover {
            background-color: #e67e22;
        }
        .main-menu, .difficulty-menu {
            position: absolute;
            color: white;
            font-size: 30px;
            top: 30%;
            text-align: center;
            z-index: 10;
        }
        .difficulty-menu {
            top: 50%;
        }
        .menu-button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .menu-button:hover {
            background-color: #2980b9;
        }
        .shop {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .shop-item {
            background-color: #f1c40f;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .shop-item:hover {
            background-color: #e67e22;
        }
        .hidden {
            display: none;
        }
        .shop-message {
            color: red;
            font-size: 18px;
            margin-top: 10px;
        }
        .back-button {
            background-color: #e74c3c;
            color: #fff;
            padding: 10px 20px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .back-button:hover {
            background-color: #c0392b;
        }
        .back-to-main-menu {
            background-color: #f39c12;
            color: white;
            font-size: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 20px;
            cursor: pointer;
        }
        .back-to-main-menu:hover {
            background-color: #e67e22;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div class="game-info score">
    Очки: <span id="score">0</span>
</div>

<div class="game-info game-over hidden" id="gameOverMessage">
    Игра окончена
    <br><button class="restart-button" id="restartBtn">Начать заново</button>
</div>

<!-- Главное меню -->
<div class="main-menu" id="mainMenu">
    <h2>Добро пожаловать в Арканоид</h2>
    <button class="menu-button" id="startBtn">Начать игру</button>
    <button class="menu-button" id="shopBtn">Магазин</button>
</div>

<!-- Меню выбора сложности -->
<div class="difficulty-menu hidden" id="difficultyMenu">
    <h2>Выберите уровень сложности</h2>
    <button class="menu-button" id="easyBtn">Легкий</button>
    <button class="menu-button" id="mediumBtn">Средний</button>
    <button class="menu-button" id="hardBtn">Сложный</button>
    <!-- Кнопка возврата на главную -->
    <button class="back-to-main-menu" id="backToMainMenuBtn">Вернуться на главную</button>
</div>

<!-- Магазин -->
<div class="shop hidden" id="shop">
    <h3>Магазин</h3>
    <button class="shop-item" id="buyExtraPaddle">Купить дополнительную платформу (1299 монет)</button>
    <button class="shop-item" id="buyPaddleColor">Изменить цвет платформы (100 монет)</button>
    <p id="coins">Монеты: 0</p>
    <div id="shopMessage" class="shop-message hidden"></div>
    <button class="back-button" id="backToMenuBtn">Вернуться в меню</button>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let canvasWidth, canvasHeight;
    let paddleX, paddleWidth = 100, paddleHeight = 20, paddleSpeed = 6;
    let ballX, ballY, ballSpeedX, ballSpeedY, ballRadius = 10;
    let bricks = [];
    let score = 0, coins = 0;
    let gameOver = false;
    let ballSpeedMultiplier = 1;
    let difficulty = "medium"; // Средняя сложность по умолчанию
    let extraPaddleCount = 0;
    let paddleColor = "#0095DD"; // Начальный цвет платформы
    let ballFreeze = false;
    let freezeTime = 0;
    let balls = [{x: ballX, y: ballY, speedX: ballSpeedX, speedY: ballSpeedY}];

    // Фон и размеры canvas
    function resizeCanvas() {
        canvasWidth = window.innerWidth;
        canvasHeight = window.innerHeight;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Блоки
    const brickWidth = 75;
    const brickHeight = 30;
    const brickPadding = 10;
    const brickOffsetTop = 30;
    const brickOffsetLeft = 30;

    function createBricks() {
        bricks = [];
        for (let row = 0; row < 5; row++) {
            bricks[row] = [];
            for (let col = 0; col < Math.floor((canvasWidth - brickOffsetLeft * 2) / (brickWidth + brickPadding)); col++) {
                bricks[row][col] = { x: 0, y: 0, status: 1, bonus: Math.random() < 0.2 ? getRandomBonus() : null };
            }
        }
    }

    function getRandomBonus() {
        const bonuses = ['split', 'speedUp', 'slowDown', 'freeze'];
        return bonuses[Math.floor(Math.random() * bonuses.length)];
    }

    // Старт игры
    function startGame() {
        gameOver = false;
        score = 0;
        coins = 0;
        ballSpeedMultiplier = 1;
        paddleX = (canvasWidth - paddleWidth) / 2;
        ballX = canvasWidth / 2;
        ballY = canvasHeight - paddleHeight - ballRadius - 10;
        ballSpeedX = 4;
        ballSpeedY = -4;

        createBricks();
        document.getElementById("gameOverMessage").classList.add("hidden");

        // Запускаем основной игровой цикл
        gameLoop();
    }

    // Главный игровой цикл
    function gameLoop() {
        if (gameOver) return;

        // Очистка экрана
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Обработка мяча
        if (!ballFreeze) {
            ballX += ballSpeedX * ballSpeedMultiplier;
            ballY += ballSpeedY * ballSpeedMultiplier;
        } else {
            freezeTime++;
            if (freezeTime > 180) {  // 3 секунды (180 кадров при 60 FPS)
                ballFreeze = false;
                freezeTime = 0;
            }
        }

        // Столкновение с границами экрана
        if (ballX + ballRadius > canvasWidth || ballX - ballRadius < 0) {
            ballSpeedX = -ballSpeedX;
        }

        if (ballY - ballRadius < 0) {
            ballSpeedY = -ballSpeedY;
        } else if (ballY + ballRadius > canvasHeight) {
            if (ballX > paddleX && ballX < paddleX + paddleWidth) {
                ballSpeedY = -ballSpeedY;
                const hitPosition = (ballX - paddleX) / paddleWidth;
                ballSpeedX = (hitPosition - 0.5) * 10;
                score++;
                coins++;
                document.getElementById("score").textContent = score;
                document.getElementById("coins").textContent = `Монеты: ${coins}`;
            } else {
                gameOver = true;
                document.getElementById("gameOverMessage").classList.remove("hidden");
                return;
            }
        }

        // Управление платформой
        document.addEventListener("mousemove", (e) => {
            paddleX = e.clientX - paddleWidth / 2;
            if (paddleX < 0) paddleX = 0;
            if (paddleX > canvasWidth - paddleWidth) paddleX = canvasWidth - paddleWidth;
        });

        // Рисуем платформу
        ctx.beginPath();
        ctx.rect(paddleX, canvasHeight - paddleHeight, paddleWidth, paddleHeight);
        ctx.fillStyle = paddleColor;
        ctx.fill();
        ctx.closePath();

        // Рисуем мяч
        balls.forEach(ball => {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
        });

        // Рисуем блоки
        for (let row = 0; row < 5; row++) {
            for (let col = 0; col < Math.floor((canvasWidth - brickOffsetLeft * 2) / (brickWidth + brickPadding)); col++) {
                let brick = bricks[row][col];
                if (brick.status === 1) {
                    let brickX = brickOffsetLeft + col * (brickWidth + brickPadding);
                    let brickY = brickOffsetTop + row * (brickHeight + brickPadding);

                    // Проверка на столкновение с мячом
                    if (ballX > brickX && ballX < brickX + brickWidth && ballY - ballRadius < brickY + brickHeight && ballY + ballRadius > brickY) {
                        ballSpeedY = -ballSpeedY;
                        brick.status = 0;  // Убираем блок
                        score += 10;
                        coins += 5;
                        document.getElementById("score").textContent = score;
                        document.getElementById("coins").textContent = `Монеты: ${coins}`;

                        // Бонус за разбивание блока
                        if (brick.bonus === 'split') {
                            balls.push({
                                x: ballX + ballRadius,
                                y: ballY,
                                speedX: ballSpeedX + 2,
                                speedY: ballSpeedY
                            });
                        } else if (brick.bonus === 'speedUp') {
                            ballSpeedMultiplier = 1.5;
                        } else if (brick.bonus === 'slowDown') {
                            ballSpeedMultiplier = 0.5;
                        } else if (brick.bonus === 'freeze') {
                            ballFreeze = true;
                        }
                    }

                    ctx.beginPath();
                    ctx.rect(brickX, brickY, brickWidth, brickHeight);
                    ctx.fillStyle = "#0095DD";
                    ctx.fill();
                    ctx.closePath();
                }
            }
        }

        // Запуск следующего кадра
        requestAnimationFrame(gameLoop);
    }

    // Кнопка перезапуска игры
    document.getElementById("restartBtn").addEventListener("click", () => startGame());

    // Кнопка возврата на главную страницу из меню сложности
    document.getElementById("backToMainMenuBtn").addEventListener("click", function() {
        document.getElementById("difficultyMenu").classList.add("hidden");
        document.getElementById("mainMenu").classList.remove("hidden");
    });

    // Кнопки для выбора уровня сложности
    document.getElementById("easyBtn").addEventListener("click", () => setDifficulty("easy"));
    document.getElementById("mediumBtn").addEventListener("click", () => setDifficulty("medium"));
    document.getElementById("hardBtn").addEventListener("click", () => setDifficulty("hard"));

    // Старт игры
    document.getElementById("startBtn").addEventListener("click", startGame);
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Арканоид с бонусами и магазином</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            height: 100%;
            background: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        canvas {
            display: block;
            background-color: #000;
            border: 1px solid #fff;
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            background-image: url('https://via.placeholder.com/1920x1080'); /* Ваш фон здесь */
            background-size: cover;
            background-position: center;
        }
        .game-info {
            position: absolute;
            color: white;
            font-size: 20px;
            z-index: 10;
        }
        .score {
            top: 10px;
            left: 10px;
        }
        .game-over {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            text-align: center;
        }
        .restart-button {
            background-color: #f1c40f;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        .restart-button:hover {
            background-color: #e67e22;
        }
        .main-menu, .difficulty-menu {
            position: absolute;
            color: white;
            font-size: 30px;
            top: 30%;
            text-align: center;
            z-index: 10;
        }
        .difficulty-menu {
            top: 50%;
        }
        .menu-button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .menu-button:hover {
            background-color: #2980b9;
        }
        .shop {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .shop-item {
            background-color: #f1c40f;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .shop-item:hover {
            background-color: #e67e22;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div class="game-info score">
    Очки: <span id="score">0</span>
</div>

<div class="game-info game-over" id="gameOverMessage">
    Игра окончена
    <br><button class="restart-button" id="restartBtn">Начать заново</button>
</div>

<!-- Главное меню -->
<div class="main-menu" id="mainMenu">
    <h2>Добро пожаловать в Арканоид</h2>
    <button class="menu-button" id="startBtn">Начать игру</button>
    <button class="menu-button" id="shopBtn">Магазин</button>
</div>

<!-- Меню выбора сложности -->
<div class="difficulty-menu" id="difficultyMenu">
    <h2>Выберите уровень сложности</h2>
    <button class="menu-button" id="easyBtn">Легкий</button>
    <button class="menu-button" id="mediumBtn">Средний</button>
    <button class="menu-button" id="hardBtn">Сложный</button>
</div>

<!-- Магазин -->
<div class="shop" id="shop">
    <h3>Магазин</h3>
    <button class="shop-item" id="buyExtraPaddle">Купить дополнительную платформу (100 монет)</button>
    <p id="coins">Монеты: 0</p>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let canvasWidth, canvasHeight;
    let paddleX, paddleWidth = 100, paddleHeight = 20, paddleSpeed = 6;
    let ballX, ballY, ballSpeedX, ballSpeedY, ballRadius = 10;
    let bricks = [];
    let bonusInterval = 100;
    let score = 0, coins = 0;
    let gameOver = false;
    let ballSpeedMultiplier = 1;
    let difficulty = "medium"; // Средняя сложность по умолчанию
    let extraPaddleCount = 0;

    // Фон и размеры canvas
    function resizeCanvas() {
        canvasWidth = window.innerWidth;
        canvasHeight = window.innerHeight;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Блоки
    const brickWidth = 75;
    const brickHeight = 30;
    const brickPadding = 10;
    const brickOffsetTop = 30;
    const brickOffsetLeft = 30;

    function createBricks() {
        bricks = [];
        for (let row = 0; row < 5; row++) {
            bricks[row] = [];
            for (let col = 0; col < Math.floor((canvasWidth - brickOffsetLeft * 2) / (brickWidth + brickPadding)); col++) {
                bricks[row][col] = { x: 0, y: 0, status: 1, bonus: null };
            }
        }
    }

    // Бонусы
    let bonuses = [];
    function createBonus(brickX, brickY) {
        const bonusType = Math.random();
        let bonus = { x: brickX, y: brickY, width: 20, height: 20, type: '' };

        if (bonusType < 0.2) {
            bonus.type = 'slowBall';  // Замедление мяча
        } else if (bonusType < 0.4) {
            bonus.type = 'freezeBall'; // Заморозка мяча
        } else if (bonusType < 0.6) {
            bonus.type = 'sizeIncrease'; // Увеличение платформы
        } else if (bonusType < 0.8) {
            bonus.type = 'speedIncrease'; // Ускорение платформы
        } else {
            bonus.type = 'ballSpeedIncrease'; // Ускорение мяча
        }

        bonuses.push(bonus);
    }

    // Обработка бонусов
    function updateBonuses() {
        bonuses.forEach((bonus, index) => {
            bonus.y += 5; // Скорость падения бонусов
            ctx.fillStyle = "#FF5733"; // Цвет бонусов
            ctx.fillRect(bonus.x, bonus.y, bonus.width, bonus.height);

            if (bonus.y + bonus.height > canvasHeight - paddleHeight && bonus.x > paddleX && bonus.x < paddleX + paddleWidth) {
                // Применяем бонус в зависимости от типа
                if (bonus.type === 'slowBall') {
                    ballSpeedMultiplier = 0.5; // Замедление мяча
                } else if (bonus.type === 'freezeBall') {
                    ballSpeedMultiplier = 0; // Заморозка мяча
                    setTimeout(() => {
                        ballSpeedMultiplier = 1; // Разморозка мяча
                    }, 2000);
                } else if (bonus.type === 'sizeIncrease') {
                    paddleWidth += 20;
                } else if (bonus.type === 'speedIncrease') {
                    paddleSpeed += 2;
                } else if (bonus.type === 'ballSpeedIncrease') {
                    ballSpeedX *= 1.2;
                    ballSpeedY *= 1.2;
                }

                bonuses.splice(index, 1); // Удалить бонус после применения
            }
        });
    }

        // Инициализация игры
    function startGame() {
        // Начальные параметры платформы и мяча
        paddleX = (canvasWidth - paddleWidth) / 2;
        ballX = canvasWidth / 2;
        ballY = canvasHeight - 30;
        ballSpeedX = 4 * ballSpeedMultiplier;  // Начальная скорость мяча по оси X
        ballSpeedY = -4 * ballSpeedMultiplier;  // Начальная скорость мяча по оси Y

        // Устанавливаем начальные параметры для игры
        score = 0;
        coins = 0;
        document.getElementById("score").textContent = score;  // Обновляем счет
        document.getElementById("coins").textContent = `Монеты: ${coins}`;  // Обновляем монеты

        // Сбрасываем флаг окончания игры
        gameOver = false;

        // Пересоздаем блоки
        createBricks();

        // Очищаем список бонусов
        bonuses = [];

        // Скрываем сообщение о конце игры
        document.getElementById("gameOverMessage").style.display = "none";

        // Запуск основного игрового цикла
        gameLoop();
    }

    // Главный игровой цикл
    function gameLoop() {
        if (gameOver) return; // Если игра окончена, не продолжаем

        // Очистка экрана
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);

        // Двигаем мяч
        ballX += ballSpeedX;
        ballY += ballSpeedY;

        // Проверка на столкновение с стенами
        if (ballX + ballRadius > canvasWidth || ballX - ballRadius < 0) {
            ballSpeedX = -ballSpeedX;  // Отражение мяча по оси X
        }
        if (ballY - ballRadius < 0) {
            ballSpeedY = -ballSpeedY;  // Отражение мяча по оси Y (от верхней границы)
        } else if (ballY + ballRadius > canvasHeight - paddleHeight) {
            // Проверка на столкновение с платформой
            if (ballX > paddleX && ballX < paddleX + paddleWidth) {
                ballSpeedY = -ballSpeedY;  // Отражение мяча от платформы
                score++;  // Увеличиваем счет
                coins++;  // Увеличиваем монеты
                document.getElementById("score").textContent = score;
                document.getElementById("coins").textContent = `Монеты: ${coins}`;
            } else if (ballY + ballRadius > canvasHeight) {
                // Если мяч падает ниже платформы (не попал)
                gameOver = true;  // Игра окончена
                document.getElementById("gameOverMessage").style.display = "block";  // Показываем сообщение
                return;  // Завершаем цикл игры
            }
        }

        // Обработка бонусов
        updateBonuses();

        // Проверка на столкновение с блоками
        for (let row = 0; row < bricks.length; row++) {
            for (let col = 0; col < bricks[row].length; col++) {
                const brick = bricks[row][col];
                if (brick.status === 1) {  // Если блок активен
                    if (ballX > brick.x && ballX < brick.x + brickWidth &&
                        ballY > brick.y && ballY < brick.y + brickHeight) {
                        // Отражение мяча
                        ballSpeedY = -ballSpeedY;
                        brick.status = 0;  // Блок уничтожен
                        createBonus(brick.x, brick.y);  // Генерация бонуса
                        score += 10;  // Увеличиваем счет
                        coins++;  // Увеличиваем монеты
                        document.getElementById("score").textContent = score;
                        document.getElementById("coins").textContent = `Монеты: ${coins}`;
                    }
                }
            }
        }

        // Рисуем блоки
        for (let row = 0; row < bricks.length; row++) {
            for (let col = 0; col < bricks[row].length; col++) {
                if (bricks[row][col].status === 1) {
                    const brick = bricks[row][col];
                    brick.x = brickOffsetLeft + col * (brickWidth + brickPadding);
                    brick.y = brickOffsetTop + row * (brickHeight + brickPadding);
                    ctx.fillStyle = "#0095DD";  // Цвет блоков
                    ctx.fillRect(brick.x, brick.y, brickWidth, brickHeight);
                }
            }
        }

        // Рисуем платформу
        ctx.fillStyle = "#0095DD";
        ctx.fillRect(paddleX, canvasHeight - paddleHeight, paddleWidth, paddleHeight);

        // Управление движением платформы
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && paddleX > 0) {
                paddleX -= paddleSpeed;  // Двигаем влево
            } else if (e.key === 'ArrowRight' && paddleX < canvasWidth - paddleWidth) {
                paddleX += paddleSpeed;  // Двигаем вправо
            }
        });

        // Продолжаем игровой цикл
        requestAnimationFrame(gameLoop);
    }

    // Функция для создания бонусов
    function createBonus(brickX, brickY) {
        const bonusType = Math.random();
        let bonus = { x: brickX, y: brickY, width: 20, height: 20, type: '' };

        // Случайное определение типа бонуса
        if (bonusType < 0.2) {
            bonus.type = 'slowBall';  // Замедление мяча
        } else if (bonusType < 0.4) {
            bonus.type = 'freezeBall'; // Заморозка мяча
        } else if (bonusType < 0.6) {
            bonus.type = 'sizeIncrease'; // Увеличение платформы
        } else if (bonusType < 0.8) {
            bonus.type = 'speedIncrease'; // Ускорение платформы
        } else {
            bonus.type = 'ballSpeedIncrease'; // Ускорение мяча
        }

        bonuses.push(bonus);  // Добавляем бонус в список
    }

    // Функция для обновления бонусов
    function updateBonuses() {
        bonuses.forEach((bonus, index) => {
            bonus.y += 5;  // Скорость падения бонусов
            ctx.fillStyle = "#FF5733";  // Цвет бонусов
            ctx.fillRect(bonus.x, bonus.y, bonus.width, bonus.height);

            if (bonus.y + bonus.height > canvasHeight - paddleHeight &&
                bonus.x > paddleX && bonus.x < paddleX + paddleWidth) {
                // Если бонус пойман
                if (bonus.type === 'slowBall') {
                    ballSpeedMultiplier = 0.5;  // Замедление мяча
                } else if (bonus.type === 'freezeBall') {
                    ballSpeedMultiplier = 0;  // Заморозка мяча
                    setTimeout(() => {
                        ballSpeedMultiplier = 1;  // Разморозка мяча
                    }, 2000);
                } else if (bonus.type === 'sizeIncrease') {
                    paddleWidth += 20;  // Увеличение размера платформы
                } else if (bonus.type === 'speedIncrease') {
                    paddleSpeed += 2;  // Ускорение платформы
                } else if (bonus.type === 'ballSpeedIncrease') {
                    ballSpeedX *= 1.2;  // Ускорение мяча
                    ballSpeedY *= 1.2;
                }

                bonuses.splice(index, 1);  // Удалить бонус после его использования
            }
        });
    }
    
    // Вспомогательные функции для создания блоков и добавления бонусов
    function createBricks() {
        bricks = [];
        for (let row = 0; row < 5; row++) {
            bricks[row] = [];
            for (let col = 0; col < Math.floor((canvasWidth - brickOffsetLeft * 2) / (brickWidth + brickPadding)); col++) {
                bricks[row][col] = { x: 0, y: 0, status: 1, bonus: null };
            }
        }
    }

    // Начало игры после перезагрузки или начала нового раунда
    document.getElementById("restartBtn").addEventListener("click", startGame);

</script>


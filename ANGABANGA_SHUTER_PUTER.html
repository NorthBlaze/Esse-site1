<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бильярд</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #2a2a2a;
        }
        canvas {
            display: block;
            margin: auto;
            background-color: green;
            border: 10px solid #804000;
            border-radius: 15px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.14.2/matter.min.js"></script>
    <script>
        const { Engine, Render, World, Bodies, Body, Events } = Matter;

        const canvas = document.getElementById('gameCanvas');
        canvas.width = window.innerWidth * 0.8;
        canvas.height = window.innerHeight * 0.8;

        const engine = Engine.create();
        const render = Render.create({
            canvas: canvas,
            engine: engine,
            options: {
                width: canvas.width,
                height: canvas.height,
                background: 'green',
                wireframes: false
            }
        });

        const tableWidth = canvas.width;
        const tableHeight = canvas.height;

        const pocketRadius = 20;

        const pockets = [
            { x: pocketRadius, y: pocketRadius },
            { x: tableWidth / 2, y: pocketRadius },
            { x: tableWidth - pocketRadius, y: pocketRadius },
            { x: pocketRadius, y: tableHeight - pocketRadius },
            { x: tableWidth / 2, y: tableHeight - pocketRadius },
            { x: tableWidth - pocketRadius, y: tableHeight - pocketRadius }
        ];

        const balls = [];
        const ballRadius = 15;

        function createBalls() {
            // Белый шар
            balls.push(Bodies.circle(tableWidth / 4, tableHeight / 2, ballRadius, {
                label: 'cueBall',
                render: { fillStyle: 'white' }
            }));

            // Цветные шары
            for (let i = 0; i < 15; i++) {
                const x = tableWidth / 1.5 + (i % 5) * (ballRadius * 2 + 5);
                const y = tableHeight / 2 + (Math.floor(i / 5) - 1) * (ballRadius * 2 + 5);
                balls.push(Bodies.circle(x, y, ballRadius, {
                    label: `ball${i + 1}`,
                    render: { fillStyle: i % 2 === 0 ? 'red' : 'yellow' }
                }));
            }
        }

        const walls = [
            // Бортики стола
            Bodies.rectangle(tableWidth / 2, -10, tableWidth, 20, { isStatic: true }),
            Bodies.rectangle(tableWidth / 2, tableHeight + 10, tableWidth, 20, { isStatic: true }),
            Bodies.rectangle(-10, tableHeight / 2, 20, tableHeight, { isStatic: true }),
            Bodies.rectangle(tableWidth + 10, tableHeight / 2, 20, tableHeight, { isStatic: true })
        ];

        function createPockets() {
            pockets.forEach(pocket => {
                World.add(engine.world, Bodies.circle(pocket.x, pocket.y, pocketRadius, {
                    isStatic: true,
                    isSensor: true,
                    render: { fillStyle: 'black' }
                }));
            });
        }

        let cueStick = null;
        let cueStickAngle = 0;
        let cueStickPower = 0;

        function createCueStick() {
            cueStick = Bodies.rectangle(tableWidth / 4, tableHeight / 2, 150, 10, {
                isStatic: true,
                render: { fillStyle: 'brown' }
            });
            World.add(engine.world, cueStick);
        }

        document.addEventListener('mousemove', (event) => {
            const cueBall = balls.find(ball => ball.label === 'cueBall');
            if (cueBall) {
                const dx = event.clientX - cueBall.position.x;
                const dy = event.clientY - cueBall.position.y;
                cueStickAngle = Math.atan2(dy, dx);
                Body.setAngle(cueStick, cueStickAngle);
                Body.setPosition(cueStick, {
                    x: cueBall.position.x - Math.cos(cueStickAngle) * 75,
                    y: cueBall.position.y - Math.sin(cueStickAngle) * 75
                });
            }
        });

        document.addEventListener('mousedown', () => {
            cueStickPower = 10; // Сила удара
        });

        document.addEventListener('mouseup', () => {
            const cueBall = balls.find(ball => ball.label === 'cueBall');
            if (cueBall) {
                const forceX = Math.cos(cueStickAngle) * cueStickPower;
                const forceY = Math.sin(cueStickAngle) * cueStickPower;
                Body.applyForce(cueBall, cueBall.position, { x: forceX, y: forceY });
            }
            cueStickPower = 0;
        });

        createBalls();
        createCueStick();
        createPockets();
        World.add(engine.world, [...balls, ...walls]);

        Events.on(engine, 'collisionStart', (event) => {
            event.pairs.forEach(pair => {
                const { bodyA, bodyB } = pair;
                const cueBall = balls.find(ball => ball.label === 'cueBall');

                // Проверяем попадание в лузы
                pockets.forEach(pocket => {
                    if (Matter.SAT.collides(bodyA, pocket).collided ||
                        Matter.SAT.collides(bodyB, pocket).collided) {
                        World.remove(engine.world, bodyA);
                        World.remove(engine.world, bodyB);
                    }
                });
            });
        });

        Render.run(render);
        Engine.run(engine);
    </script>
</body>
</html>
